<!DOCTYPE HTML>
<html lang="en">
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title> P0: Climate At a Glance </title>

    <!-- JS & CSS & Font Files/Links -->
    <link rel="stylesheet" type="text/css" href="webpage.css">
    <link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">

    <!-- Scripts -->
    <script type="text/javascript" src="scripts/d3.min.js"></script>
    <script src="scripts/graph.js" type='text/javascript'></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <style>
        body {
            background-color: #a6ddf1;
            color: white;
            font-family: 'Nunito', sans-serif;
        }

        .row-fluid {
            display: flex;
            flex-flow: row wrap;
            align-content: space-between;
        }

        #title {
            font-size: 50px;
            letter-spacing: 2.5px;
            text-align: center;
            color: black;

        }

        .label {
            font-family: "Nunito", sans-serif;
            font-size: 90%;
            font-weight: normal;
            letter-spacing: 2.0px;
        }

        .grid line {
            stroke: darkgrey;
            stroke-opacity: 0.2;
            shape-rendering: crispEdges;
        }

        .grid path {
            stroke-width: 0;
        }

        .axis {
            font-size: 11px;
            color: white;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #fff;
            shape-rendering: auto;
            font-size: 12px;
        }

        .tooltip {
            position: absolute;
            font-size: 12px;
            width:  auto;
            height: auto;
            pointer-events: none;
            background-color: white;
            color: black;
        }

        .box {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 10px;
            width: auto;
        }

        #description-box {
            margin-top: 70px;
            height: 250px;
        }

        #button-box {

        }

    </style>

</head>

<body>

    <div class="container-fluid" style="display: none">
        <h1 id="title"> ☁ Temperature Anomalies ☁ </h1>

        <script>
            d3.selectAll("h1").transition().style("color","white").duration(400);
        </script>
        <div class="row-fluid">

            <div id="box-container">
                <div class="box" id="description-box">
                    <h2> ☁ About </h2>
                    This is a bubble scatter chart which shows different temperature anomalies <br> for different regions of the world. <br>
                    <br> <p> <i>What is an anomaly?</i> <br>
                    1. something that deviates from what is standard, normal, or expected
                    <p> Feel free to click through the different regions to look at the anomalies <br>
                        You may also hover over the bubbles to get a much more accurate reading of the data</p>
                </div>
                <p></p>
                <div class="box" id="button-box">
                    <h2> ☁ Options </h2>

                    <h3> Regions </h3>
                    <div class="region-btn-group">
                        <button id="na" type="button" class="btn btn-default">North America</button>
                        <button id="as" type="button" class="btn btn-default">Asia</button>
                        <button id="eu" type="button" class="btn btn-default">Europe</button>
                        <button id="oc" type="button" class="btn btn-default">Oceania</button>
                    </div>
                </div>
            </div>

            <div id="scatterPlot" align="left" style="padding-top: 100px;"></div>

            <script>
                var margin = {top: 20, right: 20, bottom: 30, left: 70},
                    width = 960 - margin.left - margin.right,
                    height = 700 - margin.top - margin.bottom;

                var x = d3.scaleLinear().range([0, width - 100]);

                var y = d3.scaleLinear().range([height, 0]);

                var x_axis = d3.axisBottom()
                    .scale(x)
                    .ticks(30)
                    .tickFormat(d3.format("d")); // remove commas from numbers in the thousands (years)

                var y_axis = d3.axisLeft()
                    .scale(y)
                    .ticks(13);

                // gridlines in x axis function
                function x_gridlines() {
                    return d3.axisBottom(x)
                        .ticks(5)
                }

                // gridlines in y axis function
                function y_gridlines() {
                    return d3.axisLeft(y)
                        .ticks(7)
                }

                d3.csv("data/northAmerica-1987-2017.csv", function(error, data) {
                    data.forEach(function(d) {
                        d.year = +d.year;
                        d.na_value = +d.na_value;
                        d.asia_value = +d.asia_value;

                        console.log(d.asia_value);
                    });

                    x.domain([d3.min(data, function(d) { return d.year; }), d3.max(data, function (d) { return d.year; })]);

                    y.domain([d3.min(data, function (d) { return d.na_value*-1; }), d3.max(data, function (d) {return d.na_value; })]);

                    var vis = d3.select("#scatterPlot")
                        .append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                        .append("g")
                        .attr("transform",
                            "translate(" + margin.left + "," + margin.top + ")");

                    vis.append("g")
                        .attr("class", "axis")
                        .attr("transform", "translate(0," + height/2 + ")")
                        .call(x_axis)
                        .selectAll("text") // years text settings
                        .style("text-anchor", "end") //  text alignment
                        .attr("dx", "-0.7em") // x position
                        .attr("dy", "+0.10em") // y position
                        .attr("transform", "rotate(-45)" ); // transform by rotating

                    vis.append("g")
                        .attr("class", "axis")
                        .call(y_axis);

                    vis.append("g")
                        .attr("class", "grid") // x gridline
                        .attr("transform", "translate(0," + height + ")")
                        .call(x_gridlines()
                            .tickSize(-height)
                            .tickFormat("")
                        );

                    vis.append("g")
                        .attr("class", "grid")
                        .call(y_gridlines() // y gridline
                            .tickSize(-width)
                            .tickFormat("")
                        )

                    vis.append("text")
                        .attr("class", "label") // x label
                        .attr("transform",
                            "translate(" + (width-60) + " ," + (height/2) + ")") // fullwidth-70  & height/2
                        .style("text-anchor", "end") //  text alignment
                        .text("Year");

                    vis.append("text")
                        .attr("class", "label") // y label
                        .attr("transform", "rotate(-90)") // rotate 90 degrees
                        .attr("y", 0 - margin.left + 10) // y position
                        .attr("x", 0 - (height/2)) // x position
                        .attr("dy", "1em") // relative to x coord
                        .attr("text-anchor", "middle") // text alignment
                        /*
                        .attr("transform",
                            "translate(" + (width=30) + " ," + (height=0) + ")") // width is 30, height is 0
                        .style("text-anchor", "end") //  text alignment*/
                        .text("Value");

                    vis.selectAll("line")
                        .data(data)
                        .enter().append("line")
                        .attr("x", function(d) { return x(d.year); })
                        .attr("y", function(d) { return y(d.na_value); })
                        .attr("stroke", "#fff")
                        .attr("stroke-width", 1);

                    // Add the tooltip container to container-fluid
                    // it's invisible and its position/contents are defined during mouseover
                    var tooltip = d3.select("#scatterPlot")
                        .append("div")
                        .attr("class", "tooltip")
                        .style("opacity", 0);

                    // tooltip mouseover event handler
                    var mouseOver = function(d) {
                        var yearString = "Year: ";
                        var valueString = "Anomaly: ";
                        var year = yearString.fontcolor("#107896");
                        var value = valueString.fontcolor("C02F1D");
                        var result = year + d.year + "<br/>" + value + d.na_value + "<br/>";

                        tooltip.html(result)
                            .style("left", (d3.event.pageX + 10) + "px")
                            .style("top", (d3.event.pageY - 28) + "px")
                            .style("padding", "5px")
                            .transition()
                            .duration(200) // ms
                            .style("opacity", .9) // started as 0!

                    };

                    var mouseLeave = function(d) {
                        tooltip.transition()
                            .duration(300) // ms
                            .style("opacity", 0); // don't care about position!
                    };

                    vis.selectAll("dot")
                        .data(data)
                        .enter().append("circle")
                        //.attr("r", 7.0)
                        .attr("r", function(d) { return 25 * Math.sqrt(Math.abs(d.na_value) / Math.PI); }) // radius of circle
                        .attr("cx", function(d) { return x(d.year); }) // x position
                        .attr("cy", function(d) { return y(d.na_value); }) // y position
                        .style("fill-opacity", .8) // set fill opacity
                        .style("stroke", "none")    // set line colour
                        .style("fill", "white")   // set fill colour
                        .on("mouseover", mouseOver)
                        .on("mouseleave", mouseLeave);

                });

                d3.select("#scatterPlot")
                    .attr("align","right"); // Center this svg!


            </script>

        </div> <!-- row-fluid -->
    </div> <!-- container-fluid -->

    <script>
        $(document).ready(function(){
            $(".container-fluid").fadeIn("3000");
        });
    </script>

</body>
</html>